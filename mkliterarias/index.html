<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/fontawesome.css" />
    <link rel="stylesheet" href="css/bootstrap.css" />
    <title>Marikaditas Literarias</title>
    <!-- CDN Animate.css para animaciones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body class="text-secondary" id="top">

    <!--NAVBAR-->
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark">
        <div class="container d-flex align-items-center justify-content-between">
          <a href="index.html" class="navbar-brand">
            <img src="images/Recurso 1.png" alt="" width="150" />
          </a>
          <!-- Ícono de carrito SIEMPRE visible -->
          <span class="nav-item ms-auto me-3 order-lg-2">
            <span class="fa-stack position-relative" style="cursor:pointer" data-bs-toggle="modal" data-bs-target="#modalCarrito">
              <i class="fas fa-circle fa-stack-2x"></i>
              <i class="fas fa-shopping-cart fa-stack-1x text-white"></i>
              <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger animate__animated" style="font-size:0.7rem;">0</span>
            </span>
          </span>
          <button 
            class="navbar-toggler order-lg-3" 
            type="button" 
            data-bs-toggle="collapse"
            data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown"
            aria-expanded="false"
            aria-label="Toggle navigation"
          />
          <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse order-lg-1" id="navbarNavDropdown">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" aria-current="page" href="#top">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#productos">Productos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#quieness">Quienes Somos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#suscribe">Suscribete</a>
              </li>
            </ul>
            <span class="nav-item d-none d-lg-inline-block ms-2">
              <span class="fa-stack">
                <a href="#">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-facebook-f fa-stack-1x text-white"></i>
                </a>
              </span>
            </span>
            <span class="nav-item d-none d-lg-inline-block">
              <span class="fa-stack">
                <a href="#">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fab fa-twitter fa-stack-1x text-white"></i>
                </a>
              </span>
            </span>
          </div>
        </div>
      </nav>

<!--PRODUCTOS-->
<section id="productos" class="py-5">
  <div class="container">
    <div class="row mb-4">
      <div class="col text-center">
        <h1 class="text-secondary">PRODUCTOS</h1>
        <p class="text-secondary fs-5 mt-3">
          Explora nuestra colección de cajitas literarias cuidadosamente curadas. 
          Cada cajita es un tesoro que contiene artículos inspirados en obras literarias icónicas.
        </p>
      </div>
    </div>

    <div id="product-grid" class="row gy-4 gx-4">
      <!-- Los productos se cargarán aquí dinámicamente -->
    </div>
  </div>
</section>

<!-- Contenedor para los modales -->
<div id="product-modals">
  <!-- Los modales se cargarán aquí dinámicamente -->
</div>


<!-- Quienes somos-->
 <section id="quieness" class=" position-relative">
  <div class="row">
    <div class="col-xl-10 m-5 position-relative">
      <h1 class="text-uppercase text-center text-secondary m-5 fw-bold">QUIENES SOMOS</h1>
      <p class="fs-5">
        Somos un grupo de amigos bibliotecarios, que cansados de no encontrar artículos para adultos contemporáneos de los libros y géneros que nos gustan, decidimos emprender con esa idea en mente.
      </p>
      <p class="fs-5">
        A finales del 2023, con ganas de generar ingresos extras y no estar amarrados a nuestros trabajos, que son buenos, pero no tan bien pagos, buscamos una idea de negocio, nos quejabamos siempre que los productos literarios son, o muy caros o viven en contenedores de Asia con calidad dudosa y se demoran un montón, juntamos nuestros talentos, somos dos bibliotecólogas, lectoras con gustos y conocimietos literarios extraños, una linda psicóloga, un diseñador, que además es escritor y poeta; y un apasionado esposo ingeniero informático, que trabaja gratis para el emprendimiento de su amada. así conformamos Marikaditas Literarias de Pandora.
      </p>
      <p class="fs-5">
        Encontraras en nuestras cajas literarias, marikaditas para satisfacer el uso diario, pensados solo para los conocedores, pues nuestros diseños son exclusivos, sobrios, modernos y hechos en Colombia, así nos apoyamos en lo local; pensamos en nosotros como lectores estos elementos nos ayudan a vivir más en nuestro mundo privado, para hacer parte de esas historia y llevarlas con nosotros siempre. 
      </p>
      <p class="fs-5">
        Si deseas comunicarte con nosotros puedes escribirnos al Correo <a href="mailto:cuentanos@marikaditasliterarias.com">cuentanos@marikaditasliterarias.com</a> o suscribe tu email para que nos contactemos contigo.
      </p>
      <p class="text-center p-3">
        <a class="p-3" href="#">
          <i class="fab fa-twitter fa-3x "></i>
        </a>
        <a class="p-3" href="#">
          <i class="fab fa-instagram fa-3x"></i>
        </a>
        <a class="p-3" href="#">
          <i class="fab fa-linkedin fa-3x"></i>
        </a>
        <a class="p-3" href="#">
          <i class="fab fa-facebook fa-3x"></i>
        </a>
        <a href="#">
          <i class="fab fa-youtube fa-3x"></i>
        </a>
        <a class="p-3" href="#">
          <i class="fab fa-github fa-3x"></i>
        </a>
      </p>
    </div>
  </div>
 </section>

 <!-- suscribete-->
  <section id="suscribe" class="subscribe m-5">
    <div class="row">
      <div class="col m-5">
        <h5>Suscribete</h5>
        <form>
          <div class="mb-5">
            <input type="email" 
              class="form-control bg-transparent border-top-0 border-start-0 border-end-0 rounded-0 border-muted text-white"
              placeholder="Email" />
          </div>
        </form>
      </div>
    </div>
  </section>
  
  <!--Pie de pagina-->
  <footer class="border-top border-primary bg-dark text-white py-4">
    <div class="row">
      <div class="col-md-8">
        <ul class="nav">
          <li class="nav-item">
            <a href="index.html" class="nav-link link-light">Home</a>
          </li>
          <li class="nav-item">
            <a href="#details" class="nav-link link-light">Details</a>
          </li>
          <li class="nav-item">
            <a href="contact.html" class="nav-link link-light">Contact</a>
          </li>
        </ul>
      </div>
      <div class="col-md-4">
        <p class="text-end d-none d-md-block">
          Copyright &copy; Blog Mastery 2024
        </p>
      </div>
    </div>
  </footer>

    <!-- Modal Carrito de Compras -->
    <div class="modal fade" id="modalCarrito" tabindex="-1" aria-labelledby="modalCarritoLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCarritoLabel">Carrito de Compras</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <ul id="cart-items" class="list-group mb-3"></ul>
            <p class="fw-bold">Total: $<span id="cart-total">0.00</span></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="button" class="btn btn-info" id="checkout-btn">Finalizar compra</button>
          </div>
        </div>
      </div>
    </div>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <!-- Script para cargar productos dinámicamente -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const productGrid = document.getElementById('product-grid');
        const productModals = document.getElementById('product-modals');

        fetch('js/productos.json')
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok ' + response.statusText);
            }
            return response.json();
          })
          .then(productos => {
            productos.forEach(producto => {
              // Determinar la imagen para la tarjeta (la primera del array si existe)
              const cardImageHtml = (producto.imagen && producto.imagen.length > 0)
                ? `<img src="${producto.imagen[0]}" class="card-img-top rounded-4" alt="${producto.titulo}">`
                : '';

              // Crear Tarjeta de Producto
              const cardCol = document.createElement('div');
              cardCol.className = 'col-12 col-sm-6 col-md-4 col-lg-3 d-flex';
              cardCol.innerHTML = `
                <div class="card border-0 shadow-lg flex-fill">
                  ${cardImageHtml}
                  <div class="card-body text-secondary">
                    <h5 class="card-title text-secondary">${producto.titulo}</h5>
                    <p class="card-text">${producto.subtitulo}</p>
                  </div>
                  <div class="card-body d-flex justify-content-between">
                    <button class="btn btn-info add-to-cart" data-id="${producto.id}" data-nombre="${producto.titulo}" data-precio="${producto.precio.toFixed(2)}">Comprar</button>
                    <a href="#" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#modalDetalles${producto.id}">Detalles</a>
                  </div>
                </div>
              `;
              productGrid.appendChild(cardCol);

              // Generar HTML para la imagen o carrusel del modal
              let modalImageHtml = '';
              if (producto.imagen && producto.imagen.length > 1) {
                const carouselId = `carousel${producto.id}`;
                const indicators = producto.imagen.map((img, index) => `
                  <button type="button" data-bs-target="#${carouselId}" data-bs-slide-to="${index}" class="${index === 0 ? 'active' : ''}" aria-current="${index === 0 ? 'true' : 'false'}" aria-label="Slide ${index + 1}"></button>
                `).join('');
                const items = producto.imagen.map((img, index) => `
                  <div class="carousel-item ${index === 0 ? 'active' : ''}">
                    <img src="${img}" class="d-block w-100 rounded-4" alt="${producto.titulo} - Imagen ${index + 1}">
                  </div>
                `).join('');

                modalImageHtml = `
                  <div id="${carouselId}" class="carousel slide mb-3" data-bs-ride="carousel">
                    <div class="carousel-indicators">${indicators}</div>
                    <div class="carousel-inner">${items}</div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Siguiente</span>
                    </button>
                  </div>
                `;
              } else if (producto.imagen && producto.imagen.length === 1) {
                modalImageHtml = `<img src="${producto.imagen[0]}" class="img-fluid rounded-4 mb-3" alt="${producto.titulo}">`;
              }

              // Crear Modal de Producto
              const modal = document.createElement('div');
              modal.className = 'modal fade';
              modal.id = `modalDetalles${producto.id}`;
              modal.tabIndex = -1;
              modal.setAttribute('aria-labelledby', `modalDetalles${producto.id}Label`);
              modal.setAttribute('aria-hidden', 'true');
              modal.innerHTML = `
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="modalDetalles${producto.id}Label">${producto.titulo}</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      ${modalImageHtml}
                      <p>${producto.detalle}</p>
                      <p><strong>Precio:</strong> $${producto.precio.toFixed(2)}</p>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                      <button class="btn btn-info add-to-cart" data-id="${producto.id}" data-nombre="${producto.titulo}" data-precio="${producto.precio.toFixed(2)}">Comprar</button>
                    </div>
                  </div>
                </div>
              `;
              productModals.appendChild(modal);
            });
          })
          .catch(error => {
            console.error('Error al cargar los productos:', error);
            productGrid.innerHTML = '<p class="text-danger text-center col-12">No se pudieron cargar los productos. Inténtalo de nuevo más tarde.</p>';
          });
      });
    </script>
    <!-- Script para el carrito -->
    <script>
      const cart = [];
      function updateCartCount() {
        document.getElementById('cart-count').textContent = cart.reduce((acc, item) => acc + item.cantidad, 0);
      }
      function updateCartModal() {
        const cartItems = document.getElementById('cart-items');
        cartItems.innerHTML = '';
        let total = 0;
        cart.forEach((item, idx) => {
          total += item.precio * item.cantidad;
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `
            <span>${item.nombre} x${item.cantidad}</span>
            <span>$${(item.precio * item.cantidad).toFixed(2)} <button class='btn btn-sm btn-danger ms-2 remove-one' data-idx='${idx}'>&minus;</button></span>
          `;
          cartItems.appendChild(li);
        });
        document.getElementById('cart-total').textContent = total.toFixed(2);
      }
      function animateCartBadge() {
        const badge = document.getElementById('cart-count');
        badge.classList.remove('animate__bounce');
        void badge.offsetWidth; // trigger reflow
        badge.classList.add('animate__bounce');
        setTimeout(() => badge.classList.remove('animate__bounce'), 700);
      }
      // Eliminar solo uno del producto
      function removeOneFromCart(idx) {
        if (cart[idx].cantidad > 1) {
          cart[idx].cantidad -= 1;
        } else {
          cart.splice(idx, 1);
        }
        updateCartCount();
        updateCartModal();
      }
      // Solo delegación de eventos para agregar y quitar
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-to-cart')) {
          const id = e.target.getAttribute('data-id');
          const nombre = e.target.getAttribute('data-nombre');
          const precio = parseFloat(e.target.getAttribute('data-precio'));
          const found = cart.find(item => item.id === id);
          if (found) {
            found.cantidad += 1;
          } else {
            cart.push({ id, nombre, precio, cantidad: 1 });
          }
          updateCartCount();
          updateCartModal();
          animateCartBadge();
        }
        if (e.target.classList.contains('remove-one')) {
          const idx = parseInt(e.target.getAttribute('data-idx'));
          removeOneFromCart(idx);
        }
      });
      // Inicializar modal al abrir
      document.getElementById('modalCarrito').addEventListener('show.bs.modal', updateCartModal);
      
      // Botón de checkout con envío a PHP
      document.getElementById('checkout-btn').addEventListener('click', function(e) {
        const checkoutButton = e.target;
        checkoutButton.disabled = true;
        checkoutButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Enviando...';

        fetch('enviar-pedido.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ cart: cart })
        })
        .then(response => response.json().then(data => ({ok: response.ok, status: response.status, data})))
        .then(({ok, status, data}) => {
          if (ok) {
            alert('¡Gracias por tu compra! Hemos recibido tu pedido.');
            cart.length = 0; // Vaciar el carrito
            updateCartCount();
            updateCartModal();
            bootstrap.Modal.getInstance(document.getElementById('modalCarrito')).hide();
          } else {
            alert(`Error: ${data.message || 'Ocurrió un problema al enviar el pedido.'}`);
          }
        })
        .catch(error => {
          console.error('Error en la comunicación con el servidor:', error);
          alert('Error de conexión. No se pudo enviar el pedido.');
        }).finally(() => {
            checkoutButton.disabled = false;
            checkoutButton.textContent = 'Finalizar compra';
        });
      });
    </script>
</body>
</html>